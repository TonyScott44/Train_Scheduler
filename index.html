<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="UTF-8">
    <title>Train Scheduler</title>

    <!-- Bootstrap CDN-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Reference to external CSS Stylesheet -->
    <link rel="stylesheet" href="assets/css/style.css">

    <!-- LINK TO FIREBASE GOES HERE -->
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>

</head>
<body>


    <div id="headerX" class="row">
        <div class="col-lg-12" id="train-label">
            <h1>Train Scheduler</h1>
        </div>
    </div>


<div id="row1" class="row">
    <div id="col1" class="col-lg-12">
        <div  class="panel panel-default">
            <div class = "panel-body">
                <table class="table">

                    <!--Table Head-->
                    <thead>
                    <tr>
                        <b>
                            <th>Train Name</th>
                            <th>Destination</th>
                            <th>Frequency (min)</th>
                            <th>Next Arrival</th>
                            <th>Minutes Away</th>
                        </b>
                    </tr>
                    </thead>

                    <!--Table Body-->
                    <tbody id="train-list">
                    <div class="panel-body" id="recent-member">
                        <h2 id="name-display"></h2>
                        <h4 id="dest-display"></h4>
                        <h4 id="freq-display"></h4>
                        <h4 id="first-display"></h4>
                        <h4 id="away-display"></h4>
                    </div>
                    </tbody>

                </table>

            </div>
        </div>
    </div>
</div>

<div id="row2" class="row">
    <div id="col2" class="col-lg-12">
        <div  class="panel panel-default">
            <div class = "panel-body">
                <form role="form">
                    <div class="form-group">
                        <label for="train_name">Train Name:</label>
                        <input class="form-control" id="train_name" type="text">
                    </div>
                    <div class="form-group">
                        <label for="destinationX">Destination:</label>
                        <input class="form-control" id="destinationX" type="text">
                    </div>
                    <div class="form-group">
                        <label for="firstTrain">First Train Time:</label>
                        <input class="form-control" id="firstTrain" type="number">
                    </div>
                    <div class="form-group">
                        <label for="frequencyX">Frequency:</label>
                        <input class="form-control" id="frequencyX" type="number">
                    </div>
                    <button class="btn btn-default" id="add-user" type="submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- jQuery -->
<script src="https://code.jquery.com/jquery.js"></script>
<!-- Reference to external JavaScript File -->
<!--<script src="assets/javascript/logic.js"></script>-->


    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDoUSZAFPRE0CwEe3X2B1DcuRNH34KVeds",
            authDomain: "practice-9f0f7.firebaseapp.com",
            databaseURL: "https://practice-9f0f7.firebaseio.com",
            storageBucket: "practice-9f0f7.appspot.com",
            messagingSenderId: "214881515661"
        };
        firebase.initializeApp(config);


        // Get a reference to the database service
        var database = firebase.database();

        var trainName = "empty";
        var destination = "none";
        var frequency = 0;
        var nextArrival = 0;
        var minutesAway = 0;

        // On Click
        $("#add-user").on("click", function() {

            // Get the input values
            trainName = $("#train_name").val().trim();
            destination = $("#destinationX").val().trim();
            nextArrival = $("#firstTrain").val().trim();
            frequency = $("#frequencyX").val().trim();

            database.ref().push({
                tName: trainName,
                dest: destination,
                freq: frequency,
                nxtArr: nextArrival,
                minAwy: minutesAway,
                time: firebase.database.ServerValue.TIMESTAMP

            });

            event.preventDefault();
        });

        // Firebase watcher + initial loader HINT: This code behaves similarly to .on("value")
        dataRef.ref().on("child_added", function(childSnapshot) {


            // full list of items to the well
            $("#train-list").append("<tr> <td> " + childSnapshot.val().tName +
                " </td><td> " + childSnapshot.val().dest +
                " </td><td> " + childSnapshot.val().freq +
                " </td><td> " + childSnapshot.val().nxtArr +
                " </td><td> " + childSnapshot.val().minAwy + " </td></tr>");

            // Handle the errors
        }, function(errorObject) {
            console.log("Errors handled: " + errorObject.code);
        });

        dataRef.ref().orderByChild("dateAdded").limitToLast(1).on("child_added", function(snapshot) {

            // Change the HTML to reflect
            $("#name-display").appendChild(snapshot.val().tName);
            $("#dest-display").text(snapshot.val().dest);
            $("#freq-display").text(snapshot.val().freq);
            $("#first-display").text(snapshot.val().nxtArr);
            $("#away-display").text(snapshot.val().minAwy);
        });


    </script>







</body>
</html>